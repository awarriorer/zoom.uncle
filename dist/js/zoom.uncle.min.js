!function(){"use strict";var e,t=function(n,a){if(!(this instanceof t))return new t(n,a);var i={initialSlide:0,translateTime:300,maxScale:3,scaleSpeed:5,minScaleWidth:.5,dragPadding:10,wrapperClass:"zoomUncle-wrapper",slideClass:"zoomUncle-slide",slideActiveClass:"zoomUncle-slide-active",slideNextClass:"zoomUncle-slide-next",slidePrevClass:"zoomUncle-slide-prev"};a=a||{};for(var o in i)if("undefined"==typeof a[o])a[o]=i[o];else if("object"==typeof a[o])for(var r in i[o])"undefined"==typeof a[o][r]&&(a[o][r]=i[o][r]);var s=this;s.params=a,s.classNames=[],("undefined"!=typeof e||(e="undefined"==typeof Dom7?window.Dom7||window.Zepto||window.jQuery:Dom7))&&(s.$=e,s.initVal(n),s.init())};t.prototype.initVal=function(t){var n=this;n.dom={};var a=n.dom;a.$container=e(t),a.$wrapper=a.$container.find("."+n.params.wrapperClass),a.$slides=a.$wrapper.find("."+n.params.slideClass),a.$imgList=a.$wrapper.find("img"),a.$nowImg=a.$imgList.eq(0),n.val={};var i=n.val;i.containerW=a.$container.width(),i.containerH=a.$container.height(),i.slidesLen=a.$slides.length,i.startAX=0,i.startAY=0,i.endAX=0,i.endAY=0,i.startBX=0,i.startBY=0,i.translateX=0,i.bufferWidth=i.containerW/5,i.activeIndex=0,i.preDistance=0,i.nowImgBaseW=0,i.nowImgBaseH=0,i.nowImgMaxW=0,i.isScale=!1,i.nowImgLeft=0,i.nowImgTop=0,i.maxDragTop=0,i.minDragTop=0,i.dragMaxL=!1,i.dragMaxR=!1,i.a=0},t.prototype.init=function(){var e=this,t=this.dom,n=this.val;t.$wrapper.css({width:n.containerW*n.slidesLen}),t.$slides.css({width:n.containerW}),n.activeIndex=e.params.initialSlide,e.slideTo(n.activeIndex,0),e.makeImgShowBast(t.$imgList,300),e.touchFun(t.$container[0]),console.log(e)},t.prototype.touchFun=function(e){var t=this;t.dom,t.val;e.u=t,e.addEventListener("touchstart",t.touchStart,!1)},t.prototype.touchStart=function(){var e=this.u,t=e.dom,n=e.val;event.preventDefault(),e.removeAllEvent();var a=event.touches,i=t.$nowImg.width(),o=t.$nowImg.height(),r=0,s=0;n.startAX=a[0].clientX,n.startAY=a[0].clientY,n.endAX=n.startAX,n.endAY=n.startAY,n.translateX=parseInt((t.$wrapper.css("translate")+"").split(",")[0]),1==a.length&&i<=n.containerW&&(this.addEventListener("touchmove",e.swiperMove,!1),this.addEventListener("touchend",e.swiperEnd,!1)),1==a.length&&i>n.containerW&&(n.nowImgLeft=parseInt(t.$nowImg.css("left")),n.nowImgTop=parseInt(t.$nowImg.css("top")),t.maxDragTop=n.containerW>o?n.containerW-o-e.params.dragPadding:e.params.dragPadding,t.minDragTop=n.containerW>o?e.params.dragPadding:n.containerW-o-e.params.dragPadding,this.addEventListener("touchmove",e.imgDragMove,!1),this.addEventListener("touchend",e.imgDragEnd,!1)),a.length>=2&&(e.slideTo(n.activeIndex,300),r=a[1].clientX,s=a[1].clientY,e.getImgBaseSize(),n.preDistance=Math.sqrt(Math.pow(r-n.startAX,2)+Math.pow(s-n.startAY,2)),this.addEventListener("touchmove",e.imgScaleMove,!1),this.addEventListener("touchend",e.imgScaleEnd,!1))},t.prototype.swiperMove=function(){var e=this.u,t=e.dom,n=e.val;event.preventDefault();var a=event.touches[0];n.endAX=a.clientX,n.endAY=a.clientY,t.$wrapper.css({transform:"translate("+(n.translateX+n.endAX-n.startAX)+"px,0)",transition:"all 0s"})},t.prototype.swiperEnd=function(){var e=this.u,t=(e.dom,e.val),n=t.endAX-t.startAX;n>t.bufferWidth&&(t.activeIndex=e.getPreIndex(t.activeIndex),e.slideTo(t.activeIndex,300)),n<-t.bufferWidth&&(t.activeIndex=e.getNextIndex(t.activeIndex),e.slideTo(t.activeIndex,300)),-t.bufferWidth<n<t.bufferWidth&&e.slideTo(t.activeIndex,300),this.removeEventListener("touchmove",e.swiperMove,!1),this.removeEventListener("touchend",e.swiperEnd,!1)},t.prototype.imgScaleMove=function(){var e=this.u,t=e.dom,n=e.val;event.preventDefault();var a=event.touches,i=a[0].clientX,o=a[0].clientY,r=a[1].clientX,s=a[1].clientY,d=t.$nowImg.width(),c=0,m=Math.sqrt(Math.pow(r-i,2)+Math.pow(s-o,2)),l=m-n.preDistance;c=d+l*e.params.scaleSpeed,c=c<n.containerW*e.params.minScaleWidth?n.containerW*e.params.minScaleWidth:c,c=c>n.nowImgMaxW?n.nowImgMaxW:c,t.$nowImg.css({width:parseInt(c),height:parseInt(c*n.nowImgBaseH/n.nowImgBaseW),left:parseInt((n.containerW-c)/2),top:parseInt((n.containerH-c*n.nowImgBaseH/n.nowImgBaseW)/2),transition:"all 0"}),n.preDistance=m},t.prototype.imgScaleEnd=function(){var e=this.u,t=e.dom,n=e.val;t.$nowImg.width()>n.containerW?n.isScale=!0:(n.isScale=!1,e.makeImgShowBast(t.$nowImg,300)),this.removeEventListener("touchmove",e.imgScaleMove,!1),this.removeEventListener("touchend",e.imgScaleEnd,!1)},t.prototype.imgDragMove=function(){var e=this.u,t=e.dom,n=e.val;event.preventDefault();var a=event.touches[0],i=a.clientX,r=a.clientY,s=i-n.startAX+n.nowImgLeft,d=r-n.endAY+n.nowImgTop;s=s>n.dragPadding?n.dragPadding:s,s=s<n.containerW-t.$nowImg.width()-n.dragPadding?n.containerW-t.$nowImg.width()-n.dragPadding:s,d=d>n.maxDragTop?n.maxDragTop:d,d=d<n.minDragTop?n.minDragTop:d,t.$nowImg.css({left:s,top:d,transition:"all 0"}),n.dragMaxL&&s==n.dragPadding&&e.changeEvent(),n.dragMaxR&&parseInt(o.$nowImg.css("left"))==n.containerW-t.$nowImg.width()-n.dragPadding&&e.changeEvent()},t.prototype.imgDragEnd=function(){var t=this.u,n=t.dom,a=t.val,i=parseInt(n.$nowImg.css("left"));i==a.dragPadding?(a.dragMaxL=!0,e("#pA").text("已经拉到了最左边，再向左边会翻页")):a.dragMaxL=!1,i==a.containerW-n.$nowImg.width()-a.dragPadding?(a.dragMaxR=!0,e("#pA").text("已经拉到了最右边,再向右边边会翻页")):a.dragMaxR=!1,this.removeEventListener("touchmove",o.imgDragMove,!1),this.removeEventListener("touchend",o.imgDragEnd,!1)},t.prototype.slideTo=function(e,t){var n=this,a=n.dom,i=n.val;a.$wrapper.css({transform:"translate("+-e*i.containerW+"px,0)",transition:"all "+t/1e3+"s"}),i.dragMaxL=!1,i.dragMaxR=!1,a.$nowImg=a.$slides.eq(e).find("img"),a.$slides.eq(e).addClass(n.params.slideActiveClass).siblings().removeClass(n.params.slideActiveClass),a.$slides.eq(n.getNextIndex(e)).addClass(n.params.slideNextClass).siblings().removeClass(n.params.slideNextClass),a.$slides.eq(n.getPreIndex(e)).addClass(n.params.slidePrevClass).siblings().removeClass(n.params.slidePrevClass)},t.prototype.getNextIndex=function(e){var t=this,n=(t.dom,t.val),a=e+1>n.slidesLen-1?n.slidesLen-1:e+1;return a},t.prototype.getPreIndex=function(e){var t=this,n=(t.dom,t.val,0>=e-1?0:e-1);return n},t.prototype.getImgBaseSize=function(){var t=this,n=t.dom,a=t.val,i=e("<img>").attr("src",n.$nowImg.attr("src"));i.load(function(){a.nowImgBaseW=i[0].width,a.nowImgBaseH=i[0].height,a.nowImgMaxW=a.nowImgBaseW*t.params.maxScale})},t.prototype.makeImgShowBast=function(t,n){for(var a=(this.dom,this.val),i=t,o=0;o<i.length;o++)!function(t){var i=e("<img>").attr("src",t.attr("src"));i.load(function(){var e=i[0].width,o=i[0].height,r=0,s=0;e<a.containerW&&o<a.containerH?(r=e,s=o):(r=a.containerW,s=a.containerW*o/e),t.css({width:r,height:s,left:(a.containerW-r)/2,top:(a.containerH-s)/2<0?0:(a.containerH-s)/2,transition:"all "+n/1e3+"s"})})}(i.eq(o))},t.prototype.removeAllEvent=function(){var e=this,t=this.dom;this.val;t.$container[0].removeEventListener("touchmove",e.swiperMove,!1),t.$container[0].removeEventListener("touchend",e.swiperEnd,!1),t.$container[0].removeEventListener("touchmove",e.imgScaleMove,!1),t.$container[0].removeEventListener("touchend",e.imgScaleEnd,!1),t.$container[0].removeEventListener("touchmove",e.imgDragMove,!1),t.$container[0].removeEventListener("touchend",e.imgDragEnd,!1)},t.prototype.changeEvent=function(){var e=this.dom;this.val;e.$container[0].removeEventListener("touchmove",o.imgDragMove,!1),e.$container[0].removeEventListener("touchend",o.imgDragEnd,!1),e.$container[0].addEventListener("touchmove",o.swiperMove,!1),e.$container[0].addEventListener("touchend",o.swiperEnd,!1)},window.zoomUncle=t}();